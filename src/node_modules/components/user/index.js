import React, {useState} from 'react'
import {Link} from "react-router-dom"
import userImgDefault from "images/user.png"
import {followApi, unFollowApi} from "api";

const User = ({user}) => {
    const [followed, setFollowed] = useState(user.followed)

    const handleFollow = async (userId) => {
        try {
            const data = await followApi(userId)
            // console.log('data follow', data)
            if (data.resultCode === 0) {
                setFollowed(!followed)
            }
        } catch (err) {
            console.log('Error: ', err)
        }

    }

    const handleUnFollow = async (userId) => {
        try {
            const data = await unFollowApi(userId)
            // console.log('data unFollow', data)
            if (data.resultCode === 0) {
                setFollowed(!followed)
            }
        } catch (err) {
            console.log('Error: ', err)
        }

    }

    return (
        <div className="card mb-3" style={{"maxWidth": "540px", "marginTop": "16px"}}>
            <div className="row g-0">
                <div className="col-md-4">
                    <Link to={`/profile/${user.id}`}>
                        <img src={user.photos.large ? user.photos.large : userImgDefault} alt="..."
                             style={{"width": "180px", "height": "180px"}}
                        />
                    </Link>
                </div>
                <div className="col-md-8">
                    <div className="card-body">
                        <h5 className="card-title">{user.name}</h5>
                        <small className="form-text text-muted">{`id: ${user.id}`}</small>
                        {user.status
                            ? <p className="card-text">{`Status: ${user.status}`}</p>
                            : <p className="card-text text-danger">The status is not set</p>
                        }
                        {user.uniqueUrlName &&
                        <p className="card-text text-muted">{`uniqueUrlName: ${user.uniqueUrlName}`}</p>
                        }
                        {followed
                            ? <button onClick={() => handleUnFollow(user.id)} className="btn btn-danger"
                                      type="button">Unfollow
                            </button>
                            : <button onClick={() => handleFollow(user.id)} className="btn btn-success"
                                      type="button">Follow
                            </button>
                        }
                        <Link
                            to={`/dialogs/${user.id}/messages`}
                            className="btn btn-primary"
                            style={{marginLeft: '5px'}}
                        >Dialog</Link>
                    </div>
                </div>

            </div>

        </div>
    )
}

export default User