import React, {useEffect, useState} from 'react'
import {getWeather} from "api";
import 'components/weather/styles.css'

const WeatherMore = ({match}) => {
    const city = match.params.city
    const [data, setData] = useState({})
    const [newCity, setNewCity] = useState('')
    const [error, setError] = useState('')

    const handleSubmit = async (e) => {
        e.preventDefault()
        setError('')
        try {
            const data = await getWeather(newCity)
           // console.log('data new city', data)
            setData({})
            setData(data)
            setNewCity('')
        } catch (err) {
            setError('city not found')
            console.log('Error ', err)
        }
    }

    useEffect(async () => {
        try {
            const data = await getWeather(newCity ? newCity : city)
          //  console.log('data weather', data)
            setData(data)
        } catch (err) {
            console.log('Error ', err)
            setError('city not found')
        }
    }, [])

    return (
        <>
            <form className="row g-3 justify-content-md-center" onSubmit={handleSubmit}>
                <div className="col-md-auto">
                    <input
                        type="text"
                        className="form-control"
                        placeholder="Найти город..."
                        value={newCity}
                        onChange={e => {
                            setNewCity(e.target.value)
                        }}
                    />
                </div>
                <div className="col-md-auto">
                    <button
                        type="submit"
                        className="btn btn-primary mb-3"
                        disabled={!newCity}
                    >Найти
                    </button>
                </div>
            </form>
            {error &&
            <div className="row justify-content-md-center">
                <div className="col-auto">
                    <span className="text-danger"><b>{error}</b></span>
                </div>
            </div>
            }
            {data.weather &&
            <div className="row justify-content-md-center">
                <div className="card cardWeather" style={{width: "20rem"}}>
                    <div className="row justify-content-md-center">
                        <img src={`http://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`}
                             className="card-img-top" alt="..."/>
                    </div>
                    <div className="card-body" style={{padding: '0px'}}>
                        <h4 className="card-title">{data.name}</h4>
                        <p>{data.weather[0].description}</p>
                    </div>
                    <ul className="list-group list-group-flush">
                        <li className="list-group-item">Температура: {data.main.temp > 0 && '+'}{data.main.temp ? data.main.temp : '-'} &#176;C</li>
                        <li className="list-group-item">За день
                            min: {data.main.temp_min > 0 && '+'}{data.main.temp_min ? data.main.temp_min : '-'} &#176;C
                        </li>
                        <li className="list-group-item">За день
                            max: {data.main.temp_max > 0 && '+'}{data.main.temp_max ? data.main.temp_max : '-'} &#176;C
                        </li>
                        <li className="list-group-item">Ощущается
                            как: {data.main.feels_like > 0 && '+'}{data.main.feels_like ? data.main.feels_like : '-'} &#176;C
                        </li>
                        <li className="list-group-item">Влажность: {data.main.humidity ? data.main.humidity : '-'}%</li>
                        <li className="list-group-item">Облачность: {data.clouds.all ? data.clouds.all : '-'}%</li>
                        <li className="list-group-item">Давление: {data.main.pressure ? data.main.pressure : '-'} мм.рт.ст</li>
                        {data.rain &&
                        <li className="list-group-item">Дождь: {data.rain["1h"] ? data.rain["1h"] : '-'} мм.</li>
                        }
                        {data.snow &&
                        <li className="list-group-item">Снег: {data.snow["1h"] ? data.snow["1h"] : '-'} мм.</li>
                        }
                        <li className="list-group-item">Ветер: {data.wind.speed ? data.wind.speed : '-'} м/с</li>
                    </ul>
                </div>
            </div>
            }
        </>
    )
}

export default WeatherMore